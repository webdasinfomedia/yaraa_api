<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/">
    <title>Yaraa Manager AI Powered Business Suite</title>
    <meta name="description"
          content="Yaraa: Your Digital employee for remote teams & Collaboration">
    <meta name="keywords" content="Yaraa, AI, Yara AI, Task Management, Task Management System">
    <meta name="author" content="Dasinfomedia Pvt.Ltd.">
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta property="og:image" id='urlThumb' content="https://yaraamanager.com/og_image.png"/>
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="600">
    <meta property="og:title" content="Yaraa Manager AI Powered Business Suite">
    <meta property="og:description"
          content="Yaraa: Your Digital employee for remote teams & Collaboration">
    <meta property="og:locale" content="en_GB"/>
    <!-- iOS meta tags & icons -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Yaraa Manager AI Powered Business Suite">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="icon" type="image/png" sizes="72x72" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <style>
         <!--.center-item {
            height:100vh;
            display: table-cell;
            vertical-align: middle;
            width:100vw;
            text-align:center;
            }-->
         body {
         font-family: 'Poppins';
         background-color:#F0F4FD;
         }
         .img-container {
         text-align: center;
         position: fixed;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         }
         }


    </style>
    <script src="pusher.worker.min.js"></script>
    <script src="google_drive.js"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <script type="text/javascript"
            src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
    <!-- Google map key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDbvDtBT03FuJyhqwm0eoYlPhB3jqKHtI"></script>
    <script>
    function start() {
      gapi.load('auth2', function() {
        auth2 = gapi.auth2.init({
          client_id: '855681743529-ico6r6iifncub842cod4ak69le6m5ebj.apps.googleusercontent.com',
          // Scopes to request in addition to 'profile' and 'email'
          //scope: 'https://www.google.com/m8/feeds/'
        });
      });
    }


    </script>
</head>
<body>
<!--<div class="center-item">
   <img src="progress_logo.gif" alt="Please Wait..." width="80px" height="80px"/>
   </div>-->
<div class="img-container">
    <p><img src="og_image.png" align="center" width="100%" height="auto"></p>
    <img src="voice_download.gif" align="center" width="10%" height="auto" style ="border-radius: 50%;">
</div>
<div>
    <p style="position: fixed; bottom: 0; width:100%; text-align: center"><font
            color="B9C1D3">Version 1.1.8</font></p>
</div>
<!-- This script installs service_worker.js to provide PWA functionality to
   application. For more information, see:
   https://developers.google.com/web/fundamentals/primers/service-workers -->
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.6.3/firebase-auth.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.6.3/firebase-analytics.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/9.6.3/firebase-messaging.js"></script>
<meta name="google-signin-client_id"
      content="855681743529-3vnutvph4qp5c4hocflqva6064m7e779.apps.googleusercontent.com">
<script type="module">

		var serviceWorkerVersion = 10;
         // Import the functions you need from the SDKs you need
         import { initializeApp, getApp, getApps } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js";
         import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-analytics.js";
         import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-messaging.js";
         // TODO: Add SDKs for Firebase products that you want to use
         // https://firebase.google.com/docs/web/setup#available-libraries

         // Your web app's Firebase configuration
         // For Firebase JS SDK v7.20.0 and later, measurementId is optional

        var firebaseApp;
        var messaging;
        if (!getApps().length) {
           firebaseApp = initializeApp({
                 apiKey: "AIzaSyDpdlQkhHzPr8eEqS1q-igaFqu-t3Nt5SM",
                         authDomain: "yaraa-ai.firebaseapp.com",
                         projectId: "yaraa-ai",
                         storageBucket: "yaraa-ai.appspot.com",
                         messagingSenderId: "855681743529",
                         appId: "1:855681743529:web:7a1e37514cba49a082c7b8",
                         measurementId: "G-CR5FD87X17"
                }, {name: '[DEFAULT]'});
        }else{
            firebaseApp = getApp('[DEFAULT]');
        }

         // Initialize Firebase
         const analytics = getAnalytics(firebaseApp);
         messaging = getMessaging(firebaseApp);

         self.addEventListener('notificationclick', function (event) {
         console.debug('SW notification click event', event)

          var baseUrl = 'https://yaraamanager.com/';
          var url = baseUrl;
          var notificationType = event.notification.data.type;
          var moduleId = event.notification.data.module_id;
          var module = event.notification.data.module;
          var notifyId = event.notification.data.id;

          if (notificationType == "task_created" ||
                notificationType == "task_completed" ||
                notificationType == "task_new_message" ||
                notificationType == "task_reopened" ||
                notificationType == "task_restore" ||
                notificationType == "task" ||
                (notificationType == "meet_meeting_created" && module == "task")) {
              url = url+'#/tasks/detail?taskId='+moduleId+'&notify='+notifyId;
          }else if (notificationType == "milestone_reopened" ||
                      notificationType == "milestone_reopened" ||
                      notificationType == "milestone_completed" ||
                      notificationType == "added_in_project" ||
                      notificationType == "project_completed" ||
                      notificationType == "project_reopen") {
              url = url+'#/projects/detail?projectId='+moduleId+'&notify='+notifyId;
          }else if (notificationType == "todo") {
              url = url+'#/tasks/detail?todoId='+moduleId+'&notify='+notifyId;
          }else if (notificationType == "project_deleted") {
              url = url+'#/projects';
          }else if (notificationType == "task_deleted" || notificationType== "added_in_task") {
              url = url+'#/tasks';
          }else if (notificationType == "message_received" ||  (notificationType == "meet_meeting_created" && module == "message")) {
              url = url+'#/messages?messageId='+moduleId+'&notify='+notifyId;
          }
         event.waitUntil(
				clients.matchAll({type: 'window', includeUncontrolled: true,}).then( windowClients => {
					// Check if there is already a window/tab open with the target URL
							console.log("windowClients.length : ");
							console.log(windowClients.length);
						   for (var i = 0; i < windowClients.length; i++) {
							   var client = windowClients[i];
							   // If so, just focus it.
							   console.log(client.url);
							   var clientUrl = client.url;
							   if (clientUrl.includes(baseUrl) && 'focus' in client) {
							   console.log("focus find");
								   //return client.focus();
								   return client.navigate(url);
							   }
						   }
						   // If not, then open the target URL in a new window/tab.
						   if (clients.openWindow) {
						   console.log("open in new tab");
							   return clients.openWindow(url);
						   }
				})
			);
         });


         onMessage(messaging, (payload) => {

         console.log(payload);
         console.log("stringify foreground : ");
         console.log(JSON.stringify(payload));
         const title = payload.data.title;
         const type = payload.data.type;
         const options = {
         body: payload.data.description,
         icon: '/favicon.png',
         data: {
               module_id : payload.data.module_id,
               type : payload.data.type,
               id : payload.data.id
            }
         };
         window.updateNotificationCount(type);

         if ('serviceWorker' in navigator) {

			   var serviceWorkerUrl = 'flutter_service_worker.js?v=' + serviceWorkerVersion;
               navigator.serviceWorker.register(serviceWorkerUrl)
                           .then(function (registration) {
                               console.log("Service Worker Registered");
                               setTimeout(() => {
                                   registration.showNotification(title, options);
                                   registration.update();
                               }, 1000);

                           })
                           .catch(function (err) {
                               console.log("Service Worker Failed to Register", err);
                           })

            }
         });

</script>
<script>
         var serviceWorkerVersion = 10;
         var scriptLoaded = false;
         function loadMainDartJs() {
           if (scriptLoaded) {
             return;
           }
           scriptLoaded = true;
           var scriptTag = document.createElement('script');
           scriptTag.src = 'main.dart.js';
           scriptTag.type = 'application/javascript';
           document.body.append(scriptTag);
         }

         if ('serviceWorker' in navigator) {
           // Service workers are supported. Use them.
           window.addEventListener('load', function () {
             navigator.serviceWorker.register("firebase-messaging-sw.js");

             // Wait for registration to finish before dropping the <script> tag.
             // Otherwise, the browser will load the script multiple times,
             // potentially different versions.
             var serviceWorkerUrl = 'flutter_service_worker.js?v=' + serviceWorkerVersion;
             navigator.serviceWorker.register(serviceWorkerUrl)
               .then((reg) => {
                 function waitForActivation(serviceWorker) {
                   serviceWorker.addEventListener('statechange', () => {
                     if (serviceWorker.state == 'activated') {
                       console.log('Installed new service worker.');
                       loadMainDartJs();
                     }
                   });
                 }
                 if (!reg.active && (reg.installing || reg.waiting)) {
                   // No active web worker and we have installed or are installing
                   // one for the first time. Simply wait for it to activate.
                   waitForActivation(reg.installing ?? reg.waiting);
                 } else if (!reg.active.scriptURL.endsWith(serviceWorkerVersion)) {
                   // When the app updates the serviceWorkerVersion changes, so we
                   // need to ask the service worker to update.
                   console.log('New service worker available.');
                   reg.update();
                   waitForActivation(reg.installing);
                 } else {
                   // Existing service worker is still good.
                   console.log('Loading app from service worker.');
                   loadMainDartJs();
                 }
               });


             // If service worker doesn't succeed in a reasonable amount of time,
             // fallback to plaint <script> tag.
             setTimeout(() => {
               if (!scriptLoaded) {
                 console.warn(
                   'Failed to load app from service worker. Falling back to plain <script> tag.',
                 );
                 loadMainDartJs();
               }
             }, 4000);
           });
         } else {
           // Service workers not supported. Just drop the <script> tag.
           loadMainDartJs();
         }

</script>
</body>
</html>